//Simple Had application
method conditionaltest5(n:nat, q : Q[n], p : Q[n], r : Q[1], u : Q[1], N:nat)
  requires { q[0,n), p[0,n) : en(2) ↦ ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . 1/2^n | k ⟩ | j ⟩ }
  requires { r [0] : nor ↦ |0⟩ }
  requires { u [0] : nor ↦ |0⟩ }
  ensures  { q[0,n), p[0,n), u [0], r [0] : en(3) ↦ ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . ∑ t ∈ [0, 2) . 1/2^n | k ⟩ | if k < N then j + 1 else j ⟩ | if k < N then 1 else 0 ⟩ | if k < N then t else 0 ⟩ }
{
  
  if (p < N @ u[0]) { r[0] *= H; if(r[0]) {  p[0, n) *= λ (x => |x + 1⟩);} }
  //(en)q[0,n); //it is best if we do not need this
}

//sp(if C then S1 else S2, P) = sp(S1, C /\ P) \/ sp(S2, !C /\ P)
//sp(S1;S2, P) = sp(S2, sp(S1, P))

pre: q[0,n), p[0,n) : en(2) ↦ ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . 1/2^n | k ⟩ | j ⟩
     r [0] : nor ↦ |0⟩ 
     u [0] : nor ↦ |0⟩
//sp(S1, P)
/\ loc(u0) = q[0, i), p[0, n) : en(2)
/\ value(u0) = ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . 1/2^n | k ⟩ | j ⟩ 
/\ loc(v) = r[0] 
/\ value(v) = |0⟩ 
/\ loc(w) = u[0]
/\ value(w) = |0⟩
/\ value(u0.p[0, n)) < N 
/\ value(w) = 1
/\ loc(u) = q[0, n), p[0, n), u[0], r[0] : en(3)
/\ value(u) = ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . ∑ t ∈ [0, 2). 1/2^(n+1) * ω (j * t, 2)| k ⟩ | j ⟩ | 1 ⟩ | t ⟩ 
\/
/\ loc(u0) = q[0, i), p[0, n) : en(2)
/\ value(u0) = ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . 1/2^n | k ⟩ | j ⟩ 
/\ loc(v) = r[0] 
/\ value(v) = |0⟩ 
/\ loc(w) = u[0]
/\ value(w) = |0⟩
/\ value(u0.p[0, n)) >= N 
/\ value(w) = 0
/\ loc(u) = q[0, n), p[0, n), u[0], r[0]
/\ value(u) = ∑ k ∈ [0, 2^n) . ∑ j ∈ [0, 2^n) . 1/2^(n+1) * ω (j * t, 2)| k ⟩ | j ⟩ | 0 ⟩ | 0 ⟩ 

//SP(S2, sp(S1, P))

